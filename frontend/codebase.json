{
  "backend": {
    "rootDir": "backend",
    "description": "Spring Boot OrderFlow backend (Java 17, PostgreSQL, Kafka, Flyway, Testcontainers) powering catalog, ordering, payment, and outbox workflows.",
    "source": {
      "java": [
        {
          "path": "src/main/java/com/vietct/OrderFlow/OrderFlowApplication.java",
          "type": "spring_boot_application",
          "classes": [
            {
              "name": "OrderFlowApplication",
              "role": "Application entry point",
              "keyAnnotations": [
                "@SpringBootApplication"
              ],
              "responsibilities": [
                "Bootstraps the OrderFlow services and component scanning"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/config",
          "type": "spring_config",
          "classes": [
            {
              "name": "CorsConfig",
              "role": "Global CORS configuration",
              "keyAnnotations": [
                "@Configuration"
              ],
              "responsibilities": [
                "Registers a WebMvcConfigurer bean that exposes the REST API to http://localhost:3000 with standard CRUD verbs during development"
              ]
            },
            {
              "name": "JpaConfig",
              "role": "Enable auditing",
              "keyAnnotations": [
                "@Configuration",
                "@EnableJpaAuditing"
              ],
              "responsibilities": [
                "Turns on createdAt/updatedAt auditing for BaseEntity descendants"
              ]
            },
            {
              "name": "SchedulingConfig",
              "role": "Scheduling toggle",
              "keyAnnotations": [
                "@Configuration",
                "@EnableScheduling"
              ],
              "responsibilities": [
                "Allows @Scheduled jobs such as the outbox publisher to run"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/common/model/BaseEntity.java",
          "type": "jpa_base_entity",
          "classes": [
            {
              "name": "BaseEntity",
              "role": "Abstract entity with UUID id and audit timestamps",
              "keyAnnotations": [
                "@MappedSuperclass",
                "@EntityListeners(AuditingEntityListener.class)"
              ],
              "fields": [
                "UUID id",
                "Instant createdAt",
                "Instant updatedAt"
              ],
              "responsibilities": [
                "Generates UUIDs on @PrePersist and centralizes auditing metadata"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/common/error",
          "type": "error_handling",
          "classes": [
            {
              "name": "ApiErrorResponse",
              "role": "Standardized error response body",
              "fields": [
                "Instant timestamp",
                "int status",
                "String error",
                "String message",
                "String path",
                "Map<String,String> fieldErrors"
              ]
            },
            {
              "name": "GlobalExceptionHandler",
              "role": "Maps exceptions to ApiErrorResponse payloads",
              "keyAnnotations": [
                "@RestControllerAdvice"
              ],
              "handles": [
                "ProductNotFoundException/CategoryNotFoundException -> 404",
                "MethodArgumentNotValidException & ConstraintViolationException -> 400 with fieldErrors",
                "Exception -> 500 generic message"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/health/HealthController.java",
          "type": "rest_controller",
          "classes": [
            {
              "name": "HealthController",
              "role": "Simple readiness probe",
              "keyAnnotations": [
                "@RestController",
                "@RequestMapping(\"/health\")"
              ],
              "endpoints": [
                "GET /health -> always returns 200 OK"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/catalog/domain",
          "type": "jpa_domain",
          "classes": [
            {
              "name": "Category",
              "extends": "BaseEntity",
              "role": "Catalog category",
              "keyAnnotations": [
                "@Entity",
                "@Table(name = \"category\", uniqueConstraints = @UniqueConstraint(name = \"uk_category_slug\", columnNames = \"slug\"))"
              ],
              "fields": [
                "String name",
                "String slug",
                "String description",
                "List<Product> products"
              ]
            },
            {
              "name": "Product",
              "extends": "BaseEntity",
              "role": "Catalog product",
              "keyAnnotations": [
                "@Entity",
                "@Table(name = \"product\")"
              ],
              "fields": [
                "String name",
                "String description",
                "BigDecimal price",
                "Integer stock",
                "String imagePath",
                "Category category"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/catalog/repository",
          "type": "spring_data_repository",
          "interfaces": [
            {
              "name": "CategoryRepository",
              "extends": "JpaRepository<Category, UUID>",
              "customMethods": [
                "Optional<Category> findBySlug(String slug)",
                "boolean existsBySlug(String slug)"
              ]
            },
            {
              "name": "ProductRepository",
              "extends": "JpaRepository<Product, UUID>",
              "customMethods": [
                "Page<Product> findByCategoryId(UUID categoryId, Pageable pageable)"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/catalog/exception",
          "type": "domain_exception",
          "classes": [
            {
              "name": "CategoryNotFoundException",
              "role": "Thrown when a category id/slug cannot be located",
              "baseClass": "RuntimeException"
            },
            {
              "name": "ProductNotFoundException",
              "role": "Raised when a product id is missing",
              "baseClass": "RuntimeException"
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/catalog/dto",
          "type": "dto",
          "classes": [
            {
              "name": "CategoryResponseDTO",
              "role": "REST projection for categories",
              "fields": [
                "UUID id",
                "String name",
                "String slug",
                "String description"
              ]
            },
            {
              "name": "ProductResponseDTO",
              "role": "REST projection for products",
              "fields": [
                "UUID id",
                "String name",
                "String description",
                "BigDecimal price",
                "Integer stock",
                "String imagePath",
                "CategoryResponseDTO category",
                "Instant createdAt",
                "Instant updatedAt"
              ]
            },
            {
              "name": "ProductCreateRequest",
              "role": "Validation-ready DTO for creating products",
              "fields": [
                "String name",
                "String description",
                "BigDecimal price",
                "Integer stock",
                "String imagePath",
                "UUID categoryId"
              ]
            },
            {
              "name": "ProductUpdateRequest",
              "role": "Optional-field DTO for updating products",
              "fields": [
                "String name",
                "String description",
                "BigDecimal price",
                "Integer stock",
                "String imagePath",
                "UUID categoryId"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/catalog/service",
          "type": "service_layer",
          "classes": [
            {
              "name": "CatalogService",
              "role": "Read-only catalog use cases",
              "methods": [
                "Product getProductById(UUID id)",
                "Page<Product> getProducts(UUID categoryId, Pageable pageable)"
              ]
            },
            {
              "name": "CatalogServiceImpl",
              "implements": [
                "CatalogService"
              ],
              "keyAnnotations": [
                "@Service",
                "@Transactional(readOnly = true)"
              ],
              "responsibilities": [
                "Loads products by id or throws ProductNotFoundException",
                "Supports pageable listings and validates categoryId before filtering"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/catalog/controller/CatalogController.java",
          "type": "rest_controller",
          "classes": [
            {
              "name": "CatalogController",
              "role": "Catalog REST API",
              "keyAnnotations": [
                "@RestController",
                "@RequestMapping(\"/products\")",
                "@Validated"
              ],
              "endpoints": [
                "GET /products?page=&size=&sort=&categoryId= -> Page<ProductResponseDTO>",
                "GET /products/{id} -> ProductResponseDTO"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/catalog/bootstrap/CatalogManualTestRunner.java",
          "type": "command_line_runner_dev",
          "classes": [
            {
              "name": "CatalogManualTestRunner",
              "role": "Dev profile bootstrapper",
              "keyAnnotations": [
                "@Component",
                "@Profile(\"dev\")"
              ],
              "responsibilities": [
                "Seeds demo categories/products when the DB is empty",
                "Logs CatalogService.getProductById and getProducts output for manual smoke testing"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/inventory",
          "type": "inventory_module",
          "classes": [
            {
              "name": "Inventory",
              "extends": "BaseEntity",
              "role": "One-to-one product inventory record with @Version optimistic locking",
              "fields": [
                "Product product",
                "Integer availableQuantity",
                "Long version"
              ]
            },
            {
              "name": "InventoryRepository",
              "role": "Spring Data repository",
              "interfaces": [
                "JpaRepository<Inventory, UUID>"
              ],
              "customMethods": [
                "Optional<Inventory> findByProductId(UUID productId)"
              ]
            },
            {
              "name": "InventoryNotFoundException",
              "role": "Thrown when no inventory row exists for a product",
              "baseClass": "RuntimeException"
            },
            {
              "name": "InsufficientStockException",
              "role": "Raised when requested quantity exceeds available stock",
              "baseClass": "RuntimeException"
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/order/domain",
          "type": "jpa_domain",
          "classes": [
            {
              "name": "Order",
              "extends": "BaseEntity",
              "role": "Order aggregate root with status, total amount, and items",
              "fields": [
                "UUID userId",
                "OrderStatus status",
                "BigDecimal totalAmount",
                "List<OrderItem> items"
              ]
            },
            {
              "name": "OrderItem",
              "extends": "BaseEntity",
              "role": "Line item referencing Product and capturing quantity/price",
              "fields": [
                "Order order",
                "Product product",
                "Integer quantity",
                "BigDecimal priceAtOrder"
              ]
            },
            {
              "name": "OrderStatus",
              "role": "Enum of order lifecycle states",
              "values": [
                "PENDING",
                "PAID",
                "CANCELLED",
                "SHIPPED"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/order/dto",
          "type": "dto",
          "classes": [
            {
              "name": "OrderCreateRequest",
              "role": "Top-level payload for placing orders",
              "fields": [
                "UUID userId",
                "List<OrderItemRequest> items",
                "String paymentMethod"
              ]
            },
            {
              "name": "OrderItemRequest",
              "role": "Individual line request payload",
              "fields": [
                "UUID productId",
                "Integer quantity"
              ]
            },
            {
              "name": "OrderResponseDTO",
              "role": "REST response view for orders",
              "fields": [
                "UUID id",
                "UUID userId",
                "OrderStatus status",
                "BigDecimal totalAmount",
                "Instant createdAt",
                "Instant updatedAt",
                "List<OrderItemResponseDTO> items"
              ]
            },
            {
              "name": "OrderItemResponseDTO",
              "role": "Order item response projection",
              "fields": [
                "UUID productId",
                "String productName",
                "Integer quantity",
                "BigDecimal priceAtOrder"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/order/repository",
          "type": "spring_data_repository",
          "interfaces": [
            {
              "name": "OrderRepository",
              "extends": "JpaRepository<Order, UUID>",
              "customMethods": [
                "Page<Order> findByUserIdOrderByCreatedAtDesc(UUID userId, Pageable pageable)"
              ]
            },
            {
              "name": "OrderItemRepository",
              "extends": "JpaRepository<OrderItem, UUID>",
              "customMethods": [
                "List<OrderItem> findByOrderId(UUID orderId)"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/order/service",
          "type": "service_layer",
          "classes": [
            {
              "name": "OrderService",
              "role": "Ordering use cases",
              "methods": [
                "Order placeOrder(OrderCreateRequest request)",
                "Order getOrder(UUID id)"
              ]
            },
            {
              "name": "OrderServiceImpl",
              "implements": [
                "OrderService"
              ],
              "keyAnnotations": [
                "@Service"
              ],
              "responsibilities": [
                "@Transactional(isolation = Isolation.READ_COMMITTED) placeOrder builds the aggregate, enforces inventory via InventoryRepository, calculates totals, and delegates to PaymentService to mark the order PAID",
                "getOrder wraps OrderRepository::findById with OrderNotFoundException"
              ],
              "dependencies": [
                "OrderRepository",
                "ProductRepository",
                "InventoryRepository",
                "PaymentService"
              ]
            },
            {
              "name": "OrderNotFoundException",
              "role": "Raised when an order id cannot be loaded",
              "baseClass": "RuntimeException"
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/order/controller/OrderController.java",
          "type": "rest_controller",
          "classes": [
            {
              "name": "OrderController",
              "role": "Order REST API",
              "keyAnnotations": [
                "@RestController",
                "@RequestMapping(\"/orders\")"
              ],
              "endpoints": [
                "POST /orders -> creates an order from OrderCreateRequest and returns OrderResponseDTO (201)",
                "GET /orders/{id} -> fetches an OrderResponseDTO"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/order/bootstrap/OrderConcurrencyDemoRunner.java",
          "type": "command_line_runner_dev",
          "classes": [
            {
              "name": "OrderConcurrencyDemoRunner",
              "role": "Dev-only concurrency simulation",
              "keyAnnotations": [
                "@Component",
                "@Profile(\"dev\")",
                "@DependsOn(\"catalogManualTestRunner\")"
              ],
              "responsibilities": [
                "Ensures a demo product/inventory exists then runs two threads placing the same order to showcase stock protection and logging outcomes"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/payment/domain",
          "type": "jpa_domain",
          "classes": [
            {
              "name": "Payment",
              "extends": "BaseEntity",
              "role": "Payment aggregate referencing Order",
              "fields": [
                "Order order",
                "PaymentStatus status",
                "BigDecimal amount",
                "String paymentMethod"
              ]
            },
            {
              "name": "PaymentStatus",
              "role": "Enum of payment states",
              "values": [
                "INITIATED",
                "SUCCESS",
                "FAILED"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/payment/repository/PaymentRepository.java",
          "type": "spring_data_repository",
          "interfaces": [
            {
              "name": "PaymentRepository",
              "extends": "JpaRepository<Payment, UUID>",
              "customMethods": [
                "List<Payment> findByOrderId(UUID orderId)"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/payment/event/PaymentCompletedEvent.java",
          "type": "domain_event",
          "classes": [
            {
              "name": "PaymentCompletedEvent",
              "role": "Immutable record describing a successful payment",
              "fields": [
                "UUID paymentId",
                "UUID orderId",
                "BigDecimal amount",
                "String paymentMethod",
                "Instant occurredAt"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/payment/service",
          "type": "service_layer",
          "classes": [
            {
              "name": "PaymentService",
              "role": "Payment use case contract",
              "methods": [
                "Payment processPayment(Order order, BigDecimal amount, String paymentMethod)"
              ]
            },
            {
              "name": "PaymentServiceImpl",
              "implements": [
                "PaymentService"
              ],
              "keyAnnotations": [
                "@Service",
                "@Transactional"
              ],
              "responsibilities": [
                "Persists SUCCESS payments tied to an Order and amount",
                "Updates the Order status to PAID",
                "Builds a PaymentCompletedEvent, serializes to JSON via ObjectMapper, and stores an OutboxEvent with aggregateType PAYMENT/eventType PAYMENT_COMPLETED"
              ],
              "dependencies": [
                "PaymentRepository",
                "OrderRepository",
                "OutboxEventRepository",
                "ObjectMapper"
              ]
            }
          ]
        },
        {
          "path": "src/main/java/com/vietct/OrderFlow/outbox",
          "type": "outbox_module",
          "classes": [
            {
              "name": "OutboxEvent",
              "extends": "BaseEntity",
              "role": "Outbox message waiting for publication",
              "fields": [
                "String aggregateType",
                "UUID aggregateId",
                "String eventType",
                "String payload",
                "Instant processedAt"
              ]
            },
            {
              "name": "OutboxEventRepository",
              "role": "Spring Data repository with polling helper",
              "customMethods": [
                "List<OutboxEvent> findTop100ByProcessedAtIsNullOrderByCreatedAtAsc()"
              ]
            },
            {
              "name": "OutboxPublisher",
              "role": "Kafka outbox dispatcher (dev profile)",
              "keyAnnotations": [
                "@Component",
                "@Profile(\"dev\")"
              ],
              "responsibilities": [
                "@Scheduled(fixedDelay = 1000) pulls unprocessed events, sends them to Kafka topic payment.events (or fallback), and stamps processedAt once acknowledged"
              ],
              "dependencies": [
                "OutboxEventRepository",
                "KafkaTemplate<String,String>"
              ]
            }
          ]
        }
      ]
    },
    "resources": [
      {
        "path": "src/main/resources/application.properties",
        "type": "spring_config_base",
        "purpose": "Declares the OrderFlow application name and defers environment specifics to profile files"
      },
      {
        "path": "src/main/resources/application-dev.properties",
        "type": "spring_config_profile",
        "profile": "dev",
        "purpose": "Development profile pointing to local PostgreSQL and Kafka",
        "notableProperties": [
          "spring.datasource.url=jdbc:postgresql://localhost:5432/orderflow_dev",
          "spring.datasource.username=orderflow_user",
          "spring.datasource.password=mysecretpassword",
          "spring.jpa.hibernate.ddl-auto=validate",
          "spring.flyway.enabled=true",
          "spring.flyway.locations=classpath:db/migration",
          "spring.kafka.bootstrap-servers=localhost:9092",
          "spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer",
          "spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer"
        ]
      },
      {
        "path": "src/main/resources/application-test.properties",
        "type": "spring_config_profile",
        "profile": "test",
        "purpose": "Test profile used by Testcontainers; keeps Flyway + schema validation enabled",
        "notableProperties": [
          "spring.jpa.hibernate.ddl-auto=validate",
          "spring.flyway.enabled=true",
          "spring.flyway.locations=classpath:db/migration"
        ]
      },
      {
        "path": "src/main/resources/db/migration/V1__init_catalog_schema.sql",
        "type": "flyway_migration_sql",
        "version": 1,
        "description": "Initial catalog schema (category + product)",
        "operations": [
          "Create category table with UUID PK, unique slug, and auditing columns",
          "Create product table with price/stock constraints and fk_product_category",
          "Adds indexes/constraints to enforce data integrity"
        ]
      },
      {
        "path": "src/main/resources/db/migration/V2__order_payment_inventory.sql",
        "type": "flyway_migration_sql",
        "version": 2,
        "description": "Adds orders, order_item, inventory, and payment tables with supporting indexes",
        "operations": [
          "Create orders table with status + total_amount fields",
          "Create order_item table with quantity and price checks referencing orders/product",
          "Create inventory table with unique product_id, version, and non-negative constraint",
          "Create payment table with fk_payment_order and amount constraint",
          "Add indexes for common order/payment lookups"
        ]
      },
      {
        "path": "src/main/resources/db/migration/V3__outbox_event.sql",
        "type": "flyway_migration_sql",
        "version": 3,
        "description": "Introduces the outbox_event table used by the Kafka publisher",
        "operations": [
          "Create outbox_event table with aggregate metadata, payload text, and processed_at flag",
          "Add partial index idx_outbox_event_unprocessed on created_at where processed_at IS NULL"
        ]
      }
    ],
    "tests": [
      {
        "path": "src/test/java/com/vietct/OrderFlow/CatalogDatabaseIntegrationTest.java",
        "type": "integration_test",
        "frameworks": [
          "Spring Boot Test",
          "Testcontainers",
          "JUnit 5"
        ],
        "annotations": [
          "@SpringBootTest",
          "@Testcontainers"
        ],
        "purpose": "Boots the application context against a PostgreSQLContainer, applies Flyway migrations, and queries the product table via JdbcTemplate to ensure the schema is healthy.",
        "notes": [
          "Uses postgres:17-alpine and DynamicPropertySource to point Spring at the container"
        ]
      },
      {
        "path": "src/test/java/com/vietct/OrderFlow/catalog/controller/CatalogControllerTest.java",
        "type": "webmvc_slice_test",
        "frameworks": [
          "Spring WebMvcTest",
          "MockMvc",
          "Mockito",
          "JUnit 5"
        ],
        "annotations": [
          "@WebMvcTest(CatalogController.class)",
          "@Import(GlobalExceptionHandler.class)"
        ],
        "purpose": "Asserts the JSON contract, paging metadata, and validation/error handling for /products endpoints using a mocked CatalogService."
      },
      {
        "path": "src/test/java/com/vietct/OrderFlow/catalog/service/CatalogServiceImplTest.java",
        "type": "unit_test",
        "frameworks": [
          "JUnit 5",
          "Mockito",
          "AssertJ"
        ],
        "purpose": "Covers CatalogServiceImpl happy paths and exception branches with mocked ProductRepository/CategoryRepository."
      },
      {
        "path": "src/test/java/com/vietct/OrderFlow/OrderFlowApplicationTests.java",
        "type": "spring_boot_test",
        "status": "disabled",
        "annotations": [
          "@SpringBootTest",
          "@Disabled"
        ],
        "purpose": "Legacy contextLoads smoke test retained for reference; integration coverage now comes from the Testcontainers-based test."
      }
    ]
  }
}
